<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessibility Testing Lab - Excellence University</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Testing controls panel */
        .test-controls {
            position: fixed;
            left: 20px;
            top: 20px;
            background: white;
            border: 2px solid #1a5490;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            max-width: 320px;
            z-index: 9998;
            max-height: 90vh;
            overflow-y: auto;
        }

        .test-controls h2 {
            margin: 0 0 15px 0;
            font-size: 18px;
            color: #1a5490;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            font-weight: 600;
            font-size: 13px;
            color: #333;
            margin-bottom: 8px;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-value {
            font-size: 12px;
            color: #666;
            text-align: right;
        }

        .control-group button {
            width: 100%;
            padding: 8px;
            background: #1a5490;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            margin-top: 5px;
        }

        .control-group button:hover {
            background: #2c7cc1;
        }

        .control-group button.danger {
            background: #e74c3c;
        }

        .control-group button.danger:hover {
            background: #c0392b;
        }

        .violations-indicator {
            margin-top: 15px;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            font-size: 12px;
        }

        .violations-indicator.critical {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .violations-indicator strong {
            display: block;
            margin-bottom: 5px;
        }

        /* Test content area */
        .test-content {
            margin-left: 360px;
            padding: 40px;
        }

        .test-section {
            margin-bottom: 40px;
        }

        /* Dynamic test styles controlled by sliders */
        :root {
            --test-font-size: 16px;
            --test-contrast: 1;
            --test-spacing: normal;
            --test-heading-size: 2em;
        }

        .test-content p,
        .test-content li {
            font-size: var(--test-font-size);
        }

        .test-content h1 {
            font-size: var(--test-heading-size);
        }

        .low-contrast-text {
            color: rgba(0, 0, 0, var(--test-contrast));
        }

        .test-buttons button {
            margin: 5px;
        }
    </style>
</head>
<body>
    <!-- Testing Controls Panel -->
    <div class="test-controls">
        <h2>üß™ Accessibility Violation Controls</h2>
        <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
            Use these controls to create WCAG violations, then test the chatbot!
        </p>

        <!-- Font Size Control -->
        <div class="control-group">
            <label>Text Size: <span id="fontSizeValue">16px</span></label>
            <input type="range" id="fontSizeSlider" min="8" max="24" value="16" step="1">
            <div class="control-value">8px (too small) ‚Üê ‚Üí 24px (good)</div>
        </div>

        <!-- Text Contrast Control -->
        <div class="control-group">
            <label>Text Contrast: <span id="contrastValue">100%</span></label>
            <input type="range" id="contrastSlider" min="0.2" max="1" value="1" step="0.1">
            <div class="control-value">20% (poor) ‚Üê ‚Üí 100% (good)</div>
        </div>

        <!-- Heading Size Control -->
        <div class="control-group">
            <label>Heading Size: <span id="headingSizeValue">2em</span></label>
            <input type="range" id="headingSizeSlider" min="0.8" max="3" value="2" step="0.2">
            <div class="control-value">0.8em (too small) ‚Üê ‚Üí 3em (good)</div>
        </div>

        <!-- Spacing Control -->
        <div class="control-group">
            <label>Spacing:</label>
            <button id="spacingTight" onclick="setSpacing('tight')">Tight (Bad)</button>
            <button id="spacingNormal" onclick="setSpacing('normal')">Normal (Good)</button>
        </div>

        <!-- Image Alt Text Control -->
        <div class="control-group">
            <label>Image Alt Text:</label>
            <button class="danger" onclick="removeAltText()">Remove All Alt Text</button>
            <button onclick="restoreAltText()">Restore Alt Text</button>
        </div>

        <!-- Button Size Control -->
        <div class="control-group">
            <label>Interactive Elements:</label>
            <button class="danger" onclick="makeButtonsTiny()">Make Too Small</button>
            <button onclick="makeButtonsNormal()">Normal Size</button>
        </div>

        <!-- Reset All -->
        <div class="control-group">
            <button onclick="resetAll()" style="background: #27ae60;">Reset All to Compliant</button>
        </div>

        <!-- Violations Indicator -->
        <div id="violationsIndicator" class="violations-indicator">
            <strong>Current Violations: 0</strong>
            <div id="violationsList"></div>
        </div>
    </div>

    <!-- Test Content Area -->
    <div class="test-content">
        <h1 class="low-contrast-text">Accessibility Testing Lab</h1>
        
        <div class="test-section">
            <p class="low-contrast-text">
                This is a testing environment where you can intentionally break WCAG compliance 
                and then use the accessibility chatbot to fix the issues.
            </p>
            <p class="low-contrast-text">
                <strong>How to use:</strong> Use the controls on the left to create accessibility 
                violations. Then click the chatbot button in the bottom-right to analyze and fix the issues!
            </p>
        </div>

        <div class="test-section">
            <h2 class="low-contrast-text">Sample Images</h2>
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <img src="assets/campus1.jpg" alt="Modern university campus building" width="200" height="150" id="img1">
                <img src="assets/campus2.jpg" alt="Students studying in library" width="200" height="150" id="img2">
                <img src="assets/research.jpg" alt="Research laboratory equipment" width="200" height="150" id="img3">
            </div>
        </div>

        <div class="test-section">
            <h2 class="low-contrast-text">Sample Text Content</h2>
            <p class="low-contrast-text">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor 
                incididunt ut labore et dolore magna aliqua. This text will become harder to read 
                as you reduce the contrast slider.
            </p>
            <ul class="low-contrast-text">
                <li>This is a list item with test content</li>
                <li>Font size can be adjusted to be too small</li>
                <li>Contrast can be reduced to fail WCAG standards</li>
                <li>Spacing can be made too tight</li>
            </ul>
        </div>

        <div class="test-section test-buttons">
            <h2 class="low-contrast-text">Interactive Elements</h2>
            <button class="test-btn" id="btn1">Button 1</button>
            <button class="test-btn" id="btn2">Button 2</button>
            <button class="test-btn" id="btn3">Button 3</button>
            <a href="#" class="test-link" id="link1">Test Link</a>
        </div>

        <div class="test-section">
            <p class="low-contrast-text">
                <a href="index.html" id="backToMainSite">‚Üê Back to Main Site (Apply Current Settings)</a>
            </p>
        </div>
    </div>

    <!-- Chatbot Widget (from main site) -->
    <div class="chatbot-widget" id="chatbotWidget">
        <button class="chatbot-toggle" id="chatbotToggle" aria-label="Open accessibility assistant">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <span class="chatbot-badge" id="chatbotBadge">New</span>
        </button>
        
        <div class="chatbot-window" id="chatbotWindow">
            <div class="chatbot-header">
                <div class="chatbot-header-content">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <circle cx="12" cy="17" r="1"></circle>
                    </svg>
                    <div>
                        <h3>Accessibility Analyzer</h3>
                        <p class="chatbot-status">WCAG 2.1 Compliance</p>
                    </div>
                </div>
                <div class="chatbot-header-actions">
                    <button class="chatbot-reset" id="chatbotReset" aria-label="Reset to original" title="Reset to original">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="1 4 1 10 7 10"></polyline>
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                        </svg>
                    </button>
                    <button class="chatbot-close" id="chatbotClose" aria-label="Close chat">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="chatbot-messages" id="chatbotMessages">
                <div class="chatbot-message bot-message">
                    <div class="message-avatar">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                            <circle cx="12" cy="17" r="1"></circle>
                        </svg>
                    </div>
                    <div class="message-content">
                        <p>üëã Welcome to the Testing Lab! Use the controls on the left to create accessibility violations, then click <strong>"Analyze Page"</strong> to detect and fix them.</p>
                    </div>
                </div>
            </div>
            
            <div class="chatbot-actions-bar">
                <button class="chatbot-check-btn" id="chatbotCheckBtn" aria-label="Analyze page for accessibility improvements">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                    Analyze Page for Accessibility
                </button>
            </div>
            
            <div class="chatbot-typing" id="chatbotTyping" style="display: none;">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </div>

    <script src="api-key.js"></script>
    <script src="ai-config.js"></script>
    <script src="script.js"></script>
    <script>
        // Testing controls JavaScript
        let violations = [];
        const originalAltTexts = {};

        // Font size slider
        document.getElementById('fontSizeSlider').addEventListener('input', (e) => {
            const size = e.target.value + 'px';
            document.documentElement.style.setProperty('--test-font-size', size);
            document.getElementById('fontSizeValue').textContent = size;
            saveTestSettings();
            updateViolations();
        });

        // Contrast slider
        document.getElementById('contrastSlider').addEventListener('input', (e) => {
            const contrast = e.target.value;
            document.documentElement.style.setProperty('--test-contrast', contrast);
            document.getElementById('contrastValue').textContent = Math.round(contrast * 100) + '%';
            saveTestSettings();
            updateViolations();
        });

        // Heading size slider
        document.getElementById('headingSizeSlider').addEventListener('input', (e) => {
            const size = e.target.value + 'em';
            document.documentElement.style.setProperty('--test-heading-size', size);
            document.getElementById('headingSizeValue').textContent = size;
            saveTestSettings();
            updateViolations();
        });

        // Save test settings to localStorage
        function saveTestSettings() {
            const settings = {
                fontSize: document.getElementById('fontSizeSlider').value,
                contrast: document.getElementById('contrastSlider').value,
                headingSize: document.getElementById('headingSizeSlider').value,
                spacing: getCurrentSpacing(),
                hasAltText: hasImagesWithAltText(),
                buttonSize: getButtonSize()
            };
            localStorage.setItem('testLabSettings', JSON.stringify(settings));
        }

        // Load test settings from localStorage
        function loadTestSettings() {
            const saved = localStorage.getItem('testLabSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                
                if (settings.fontSize) {
                    document.getElementById('fontSizeSlider').value = settings.fontSize;
                    document.documentElement.style.setProperty('--test-font-size', settings.fontSize + 'px');
                    document.getElementById('fontSizeValue').textContent = settings.fontSize + 'px';
                }
                
                if (settings.contrast) {
                    document.getElementById('contrastSlider').value = settings.contrast;
                    document.documentElement.style.setProperty('--test-contrast', settings.contrast);
                    document.getElementById('contrastValue').textContent = Math.round(settings.contrast * 100) + '%';
                }
                
                if (settings.headingSize) {
                    document.getElementById('headingSizeSlider').value = settings.headingSize;
                    document.documentElement.style.setProperty('--test-heading-size', settings.headingSize + 'em');
                    document.getElementById('headingSizeValue').textContent = settings.headingSize + 'em';
                }
                
                if (settings.spacing) {
                    setSpacing(settings.spacing);
                }
                
                if (!settings.hasAltText) {
                    removeAltText();
                }
                
                if (settings.buttonSize === 'tiny') {
                    makeButtonsTiny();
                }
                
                updateViolations();
            }
        }

        // Alt text controls
        function removeAltText() {
            document.querySelectorAll('.test-content img').forEach((img, i) => {
                if (!originalAltTexts[i]) {
                    originalAltTexts[i] = img.alt;
                }
                img.alt = '';
            });
            saveTestSettings();
            updateViolations();
        }

        function restoreAltText() {
            document.querySelectorAll('.test-content img').forEach((img, i) => {
                img.alt = originalAltTexts[i] || 'Image';
            });
            saveTestSettings();
            updateViolations();
        }

        // Button size controls
        function makeButtonsTiny() {
            document.querySelectorAll('.test-btn, .test-link').forEach(el => {
                el.style.padding = '2px 4px';
                el.style.fontSize = '10px';
            });
            saveTestSettings();
            updateViolations();
        }

        function makeButtonsNormal() {
            document.querySelectorAll('.test-btn, .test-link').forEach(el => {
                el.style.padding = '';
                el.style.fontSize = '';
            });
            saveTestSettings();
            updateViolations();
        }

        // Spacing controls
        function setSpacing(type) {
            if (type === 'tight') {
                document.querySelectorAll('.test-section').forEach(el => {
                    el.style.marginBottom = '10px';
                    el.style.lineHeight = '1.2';
                });
            } else {
                document.querySelectorAll('.test-section').forEach(el => {
                    el.style.marginBottom = '40px';
                    el.style.lineHeight = '1.6';
                });
            }
            saveTestSettings();
            updateViolations();
        }



        // Reset all
        function resetAll() {
            document.getElementById('fontSizeSlider').value = 16;
            document.getElementById('contrastSlider').value = 1;
            document.getElementById('headingSizeSlider').value = 2;
            document.documentElement.style.setProperty('--test-font-size', '16px');
            document.documentElement.style.setProperty('--test-contrast', '1');
            document.documentElement.style.setProperty('--test-heading-size', '2em');
            document.getElementById('fontSizeValue').textContent = '16px';
            document.getElementById('contrastValue').textContent = '100%';
            document.getElementById('headingSizeValue').textContent = '2em';
            setSpacing('normal');
            restoreAltText();
            makeButtonsNormal();
            updateViolations();
        }

        // Update violations counter
        function updateViolations() {
            violations = [];
            
            // Check font size
            const fontSize = parseInt(document.getElementById('fontSizeSlider').value);
            if (fontSize < 14) violations.push('Text too small (< 14px)');
            
            // Check contrast
            const contrast = parseFloat(document.getElementById('contrastSlider').value);
            if (contrast < 0.7) violations.push('Insufficient contrast');
            
            // Check heading size
            const headingSize = parseFloat(document.getElementById('headingSizeSlider').value);
            if (headingSize < 1.5) violations.push('Headings too small');
            
            // Check alt text
            const missingAlt = Array.from(document.querySelectorAll('.test-content img')).filter(img => !img.alt).length;
            if (missingAlt > 0) violations.push(`${missingAlt} images missing alt text`);
            
            // Check button sizes
            const tinyButtons = Array.from(document.querySelectorAll('.test-btn')).filter(btn => {
                return btn.style.padding === '2px 4px';
            }).length;
            if (tinyButtons > 0) violations.push('Interactive elements too small');
            
            // Update indicator
            const indicator = document.getElementById('violationsIndicator');
            const violationsList = document.getElementById('violationsList');
            
            if (violations.length === 0) {
                indicator.className = 'violations-indicator';
                violationsList.innerHTML = '<div style="color: #27ae60;">‚úì All compliant</div>';
            } else {
                indicator.className = violations.length >= 3 ? 'violations-indicator critical' : 'violations-indicator';
                violationsList.innerHTML = violations.map(v => `<div>‚Ä¢ ${v}</div>`).join('');
            }
            
            document.querySelector('#violationsIndicator strong').textContent = 
                `Current Violations: ${violations.length}`;
        }

        // Helper functions
        function getCurrentSpacing() {
            const section = document.querySelector('.test-section');
            return section && section.style.marginBottom === '10px' ? 'tight' : 'normal';
        }

        function hasImagesWithAltText() {
            return Array.from(document.querySelectorAll('.test-content img')).every(img => img.alt);
        }

        function getButtonSize() {
            const btn = document.querySelector('.test-btn');
            return btn && btn.style.padding === '2px 4px' ? 'tiny' : 'normal';
        }

        // Initialize on page load
        loadTestSettings();
        updateViolations();
    </script>
</body>
</html>
